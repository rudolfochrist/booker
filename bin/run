#!/bin/bash

# see https://github.com/adriancooney/Taskfile

function start() {
    sbcl --no-userinit --load init.lisp
}

function tests() {
    sbcl --non-interactive --no-userinit --load init.lisp \
         --eval '(asdf:test-system "booker")'
}

function clean() {
    find "$PWD" -name "*.fasl" -delete
}

function deps:install() {
    name="$(basename "$PWD")"
    system_name="${1:-$name}"
    echo "Installing systems."
    ocicl install

    echo "Preloading systems."
    sbcl --non-interactive --no-userinit \
         --load init.lisp \
         --eval "(asdf:load-system \"${system_name}\" :force :all)" \
         --eval '(uiop:quit)'
}

function deps:clear() {
    rm -rf systems/
}

function help() {
    compgen -A function | sort -n | cat -n
}

function default() {
    start
}

TIMEFORMAT="Task completed in %3lR"
time "${@:-default}"
